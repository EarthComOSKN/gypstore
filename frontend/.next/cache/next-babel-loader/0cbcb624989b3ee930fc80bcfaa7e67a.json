{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/nutchanonploypray/work/gypstore/frontend/src/features/shopping-cart/ShoppingCart.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  & svg {\\n    fill: red;\\n  }\\n  margin-left: 1rem;\\n  font-size: 1.25rem;\\n\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: #ff8e0a;\\n  font-size: 1rem;\\n  padding: 0rem 2rem;\\n\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: flex-start;\\n  align-items: center;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-gap: 1rem;\\n  grid-template-columns: 1fr 3fr;\\n  padding: 1rem;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  padding: 1rem 2rem;\\n  background-color: white;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-columns: 3fr 1fr 1fr 1fr;\\n  grid-gap: 1.5rem;\\n  background-color: white;\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  background-color: rgb(236, 236, 236);\\n  grid-gap: 1px;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: white;\\n  width: 90%;\\n  margin: 2rem auto;\\n  padding: 2rem;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport styled from '@emotion/styled';\nimport { ProductCardTall } from '../product/ProductCardTall';\nimport { AmountInput } from '../../component/AmountInput';\nimport { Button, message, Icon, Modal } from 'antd';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport { DELETE_ITEM } from './gql';\nimport { GET_ME } from '../navigation/gql';\nimport { useRouter } from 'next/router';\nvar confirm = Modal.confirm;\nvar Container = styled.div(_templateObject());\nvar CartTable = styled.div(_templateObject2());\nvar CartRow = styled.div(_templateObject3());\nvar CartSumRow = styled.div(_templateObject4());\nvar Product = styled.div(_templateObject5());\nvar Price = styled.div(_templateObject6());\nvar Amount = styled(Price)(_templateObject7());\nvar ProductName = styled(Price)(_templateObject8());\nvar StyledButton = styled(Button)(_templateObject9());\nvar DeleteIcon = styled(Icon)(_templateObject10());\nexport var ShoppingCart = function ShoppingCart() {\n  var _useQuery = useQuery(GET_ME),\n      data = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error;\n\n  var router = useRouter();\n\n  var _useMutation = useMutation(DELETE_ITEM, {\n    update: function update(cache, mutationResult) {\n      var _cache$readQuery = cache.readQuery({\n        query: GET_ME\n      }),\n          me = _cache$readQuery.me;\n\n      var user = me;\n\n      var oldShoppingItems = _toConsumableArray(user.shoppingCart.productItems);\n\n      var newShoppingItems = oldShoppingItems.filter(function (i) {\n        return i.id !== mutationResult.data.deleteShoppingCartItem.id;\n      });\n\n      var newUser = _objectSpread({}, user);\n\n      newUser.shoppingCart.productItems = _toConsumableArray(newShoppingItems); // cache.writeData(newUser)\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      deleteProductItem = _useMutation2[0];\n\n  if (loading) return __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }, \"Lodaing...\");\n\n  if (!data) {\n    router.push('/signin');\n    return null;\n  }\n\n  var me = data.me;\n  var shoppingCart = me.shoppingCart;\n  var shoppingCartItems = shoppingCart.productItems;\n\n  var showDeleteConfirm = function showDeleteConfirm(key, name) {\n    return _regeneratorRuntime.async(function showDeleteConfirm$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            confirm({\n              title: \"\\u0E04\\u0E38\\u0E13\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\\u0E19\\u0E33\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 \".concat(name, \" \\u0E2D\\u0E2D\\u0E01\\u0E43\\u0E0A\\u0E48\\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E44\\u0E21\\u0E48?\"),\n              content: '',\n              okText: 'ลบ',\n              okType: 'danger',\n              cancelText: 'ยกเลิก',\n              onOk: function onOk() {\n                return _regeneratorRuntime.async(function onOk$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.next = 2;\n                        return _regeneratorRuntime.awrap(deleteItem(key));\n\n                      case 2:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                });\n              },\n              onCancel: function onCancel() {\n                console.log('Cancel');\n              }\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    });\n  };\n\n  var deleteItem = function deleteItem(key) {\n    return _regeneratorRuntime.async(function deleteItem$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(deleteProductItem({\n              variables: {\n                key: key\n              }\n            }));\n\n          case 3:\n            message.success('รบรายการ สำเร็จ');\n            _context3.next = 9;\n            break;\n\n          case 6:\n            _context3.prev = 6;\n            _context3.t0 = _context3[\"catch\"](0);\n            message.error('error has occur');\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 6]]);\n  };\n\n  return __jsx(Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, __jsx(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, \"\\u0E23\\u0E16\\u0E40\\u0E02\\u0E47\\u0E19\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 (\", shoppingCartItems.length, \")\"), __jsx(CartTable, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, __jsx(CartRow, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, __jsx(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"), __jsx(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, \"\\u0E23\\u0E32\\u0E04\\u0E32\"), __jsx(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, \"\\u0E1B\\u0E23\\u0E34\\u0E21\\u0E32\\u0E13\"), __jsx(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, \"\\u0E23\\u0E32\\u0E04\\u0E32\\u0E23\\u0E27\\u0E21\")), shoppingCartItems.map(function (item) {\n    var product = item.product,\n        amount = item.amount;\n    return __jsx(CartRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, __jsx(Product, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, __jsx(ProductCardTall, {\n      buyable: false,\n      onlyImage: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), __jsx(ProductName, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, product.name, __jsx(DeleteIcon, {\n      onClick: function onClick() {\n        return showDeleteConfirm(\"\".concat(product.id).concat(shoppingCart.id), product.name);\n      },\n      type: \"delete\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }))), __jsx(Price, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, product.salePrice, \" \\u0E1A\\u0E32\\u0E17 / \", product.unitType), __jsx(Amount, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, __jsx(AmountInput, {\n      onChange: function onChange(e) {\n        return null;\n      },\n      amount: amount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    })), __jsx(Price, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, (+product.salePrice * amount).toLocaleString(), \" \\u0E1A\\u0E32\\u0E17\"));\n  }), __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, __jsx(CartSumRow, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, __jsx(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, \"\\u0E23\\u0E32\\u0E04\\u0E32\\u0E23\\u0E27\\u0E21 (\", shoppingCartItems.length, \" \\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23)\"), __jsx(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, shoppingCartItems.reduce(function (prv, cur) {\n    return prv + cur.amount * +cur.product.salePrice;\n  }, 0).toLocaleString(), ' ', \"\\u0E1A\\u0E32\\u0E17\")), __jsx(CartSumRow, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, __jsx(StyledButton, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, \"\\u0E1E\\u0E34\\u0E21\\u0E1E\\u0E4C\\u0E43\\u0E1A\\u0E40\\u0E2A\\u0E19\\u0E2D\\u0E23\\u0E32\\u0E04\\u0E32\"), __jsx(StyledButton, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, \"\\u0E16\\u0E31\\u0E14\\u0E44\\u0E1B\")))));\n};","map":{"version":3,"sources":["/Users/nutchanonploypray/work/gypstore/frontend/src/features/shopping-cart/ShoppingCart.tsx"],"names":["styled","ProductCardTall","AmountInput","Button","message","Icon","Modal","useQuery","useMutation","DELETE_ITEM","GET_ME","useRouter","confirm","Container","div","CartTable","CartRow","CartSumRow","Product","Price","Amount","ProductName","StyledButton","DeleteIcon","ShoppingCart","data","loading","error","router","update","cache","mutationResult","readQuery","query","me","user","oldShoppingItems","shoppingCart","productItems","newShoppingItems","filter","i","id","deleteShoppingCartItem","newUser","deleteProductItem","push","shoppingCartItems","showDeleteConfirm","key","name","title","content","okText","okType","cancelText","onOk","deleteItem","onCancel","console","log","variables","success","length","map","item","product","amount","salePrice","unitType","e","toLocaleString","reduce","prv","cur"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,iBAAnB;AACA,SAASC,eAAT,QAAgC,4BAAhC;AACA,SAASC,WAAT,QAA4B,6BAA5B;AACA,SAASC,MAAT,EAAiBC,OAAjB,EAA0BC,IAA1B,EAAgCC,KAAhC,QAA6C,MAA7C;AACA,SAASC,QAAT,EAAmBC,WAAnB,QAAsC,qBAAtC;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,SAASC,SAAT,QAA0B,aAA1B;IACQC,O,GAAYN,K,CAAZM,O;AAER,IAAMC,SAAS,GAAGb,MAAM,CAACc,GAAV,mBAAf;AAOA,IAAMC,SAAS,GAAGf,MAAM,CAACc,GAAV,oBAAf;AAOA,IAAME,OAAO,GAAGhB,MAAM,CAACc,GAAV,oBAAb;AAMA,IAAMG,UAAU,GAAGjB,MAAM,CAACc,GAAV,oBAAhB;AAMA,IAAMI,OAAO,GAAGlB,MAAM,CAACc,GAAV,oBAAb;AAMA,IAAMK,KAAK,GAAGnB,MAAM,CAACc,GAAV,oBAAX;AAKA,IAAMM,MAAM,GAAGpB,MAAM,CAACmB,KAAD,CAAT,oBAAZ;AACA,IAAME,WAAW,GAAGrB,MAAM,CAACmB,KAAD,CAAT,oBAAjB;AACA,IAAMG,YAAY,GAAGtB,MAAM,CAACG,MAAD,CAAT,oBAAlB;AAKA,IAAMoB,UAAU,GAAGvB,MAAM,CAACK,IAAD,CAAT,qBAAhB;AASA,OAAO,IAAMmB,YAAY,GAAG,SAAfA,YAAe,GAAM;AAAA,kBACCjB,QAAQ,CAACG,MAAD,CADT;AAAA,MACxBe,IADwB,aACxBA,IADwB;AAAA,MAClBC,OADkB,aAClBA,OADkB;AAAA,MACTC,KADS,aACTA,KADS;;AAEhC,MAAMC,MAAM,GAAGjB,SAAS,EAAxB;;AAFgC,qBAGJH,WAAW,CAACC,WAAD,EAAc;AACnDoB,IAAAA,MADmD,kBAC5CC,KAD4C,EACrCC,cADqC,EACrB;AAAA,6BACbD,KAAK,CAACE,SAAN,CAAgB;AAAEC,QAAAA,KAAK,EAAEvB;AAAT,OAAhB,CADa;AAAA,UACpBwB,EADoB,oBACpBA,EADoB;;AAE5B,UAAMC,IAAI,GAAGD,EAAb;;AACA,UAAME,gBAAgB,sBAAOD,IAAI,CAACE,YAAL,CAAkBC,YAAzB,CAAtB;;AACA,UAAMC,gBAAgB,GAAGH,gBAAgB,CAACI,MAAjB,CACvB,UAAAC,CAAC;AAAA,eAAIA,CAAC,CAACC,EAAF,KAASX,cAAc,CAACN,IAAf,CAAoBkB,sBAApB,CAA2CD,EAAxD;AAAA,OADsB,CAAzB;;AAGA,UAAME,OAAO,qBAAQT,IAAR,CAAb;;AACAS,MAAAA,OAAO,CAACP,YAAR,CAAqBC,YAArB,sBAAwCC,gBAAxC,EAR4B,CAS5B;AACD;AAXkD,GAAd,CAHP;AAAA;AAAA,MAGzBM,iBAHyB;;AAgBhC,MAAInB,OAAJ,EAAa,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAP;;AACb,MAAI,CAACD,IAAL,EAAW;AACTG,IAAAA,MAAM,CAACkB,IAAP,CAAY,SAAZ;AACA,WAAO,IAAP;AACD;;AACD,MAAMZ,EAAE,GAAGT,IAAI,CAACS,EAAhB;AACA,MAAMG,YAAY,GAAGH,EAAE,CAACG,YAAxB;AACA,MAAMU,iBAAiB,GAAGV,YAAY,CAACC,YAAvC;;AAEA,MAAMU,iBAAiB,GAAG,SAApBA,iBAAoB,CAAOC,GAAP,EAAoBC,IAApB;AAAA;AAAA;AAAA;AAAA;AACxBtC,YAAAA,OAAO,CAAC;AACNuC,cAAAA,KAAK,yHAAwBD,IAAxB,qFADC;AAENE,cAAAA,OAAO,EAAE,EAFH;AAGNC,cAAAA,MAAM,EAAE,IAHF;AAINC,cAAAA,MAAM,EAAE,QAJF;AAKNC,cAAAA,UAAU,EAAE,QALN;AAMAC,cAAAA,IANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yDAOEC,UAAU,CAACR,GAAD,CAPZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASNS,cAAAA,QATM,sBASK;AACTC,gBAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACD;AAXK,aAAD,CAAP;;AADwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA1B;;AAgBA,MAAMH,UAAU,GAAG,SAAbA,UAAa,CAAOR,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAETJ,iBAAiB,CAAC;AAAEgB,cAAAA,SAAS,EAAE;AAAEZ,gBAAAA,GAAG,EAAHA;AAAF;AAAb,aAAD,CAFR;;AAAA;AAGf7C,YAAAA,OAAO,CAAC0D,OAAR,CAAgB,iBAAhB;AAHe;AAAA;;AAAA;AAAA;AAAA;AAKf1D,YAAAA,OAAO,CAACuB,KAAR,CAAc,iBAAd;;AALe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAnB;;AASA,SACE,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mFAAmBoB,iBAAiB,CAACgB,MAArC,MADF,EAEE,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAFF,EAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CAHF,EAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDAJF,CADF,EAOGhB,iBAAiB,CAACiB,GAAlB,CAAsB,UAAAC,IAAI,EAAI;AAAA,QACrBC,OADqB,GACDD,IADC,CACrBC,OADqB;AAAA,QACZC,MADY,GACDF,IADC,CACZE,MADY;AAE7B,WACE,MAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,eAAD;AAAiB,MAAA,OAAO,EAAE,KAA1B;AAAiC,MAAA,SAAS,MAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,EAEE,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGD,OAAO,CAAChB,IADX,EAEE,MAAC,UAAD;AACE,MAAA,OAAO,EAAE;AAAA,eACPF,iBAAiB,WACZkB,OAAO,CAACxB,EADI,SACCL,YAAY,CAACK,EADd,GAEfwB,OAAO,CAAChB,IAFO,CADV;AAAA,OADX;AAOE,MAAA,IAAI,EAAC,QAPP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,CAFF,CADF,EAgBE,MAAC,KAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGgB,OAAO,CAACE,SADX,4BAC6BF,OAAO,CAACG,QADrC,CAhBF,EAmBE,MAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,WAAD;AAAa,MAAA,QAAQ,EAAE,kBAAAC,CAAC;AAAA,eAAI,IAAJ;AAAA,OAAxB;AAAkC,MAAA,MAAM,EAAEH,MAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAnBF,EAsBE,MAAC,KAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,CAAC,CAACD,OAAO,CAACE,SAAT,GAAqBD,MAAtB,EAA8BI,cAA9B,EADH,wBAtBF,CADF;AA4BD,GA9BA,CAPH,EAsCE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAAcxB,iBAAiB,CAACgB,MAAhC,2CADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGhB,iBAAiB,CACfyB,MADF,CAEG,UAACC,GAAD,EAAMC,GAAN;AAAA,WAAcD,GAAG,GAAGC,GAAG,CAACP,MAAJ,GAAa,CAACO,GAAG,CAACR,OAAJ,CAAYE,SAA9C;AAAA,GAFH,EAGG,CAHH,EAKEG,cALF,EADH,EAMuB,GANvB,uBAFF,CADF,EAaE,MAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kGADF,EAEE,MAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAFF,CAbF,CAtCF,CAFF,CADF;AA8DD,CAhHM","sourcesContent":["import styled from '@emotion/styled'\nimport { ProductCardTall } from '../product/ProductCardTall'\nimport { AmountInput } from '../../component/AmountInput'\nimport { Button, message, Icon, Modal } from 'antd'\nimport { useQuery, useMutation } from '@apollo/react-hooks'\nimport { DELETE_ITEM } from './gql'\nimport { GET_ME } from '../navigation/gql'\nimport { useRouter } from 'next/router'\nconst { confirm } = Modal\n\nconst Container = styled.div`\n  background-color: white;\n  width: 90%;\n  margin: 2rem auto;\n  padding: 2rem;\n`\n\nconst CartTable = styled.div`\n  display: grid;\n  grid-template-rows: 1fr;\n  background-color: rgb(236, 236, 236);\n  grid-gap: 1px;\n`\n\nconst CartRow = styled.div`\n  display: grid;\n  grid-template-columns: 3fr 1fr 1fr 1fr;\n  grid-gap: 1.5rem;\n  background-color: white;\n`\nconst CartSumRow = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: 1rem 2rem;\n  background-color: white;\n`\nconst Product = styled.div`\n  display: grid;\n  grid-gap: 1rem;\n  grid-template-columns: 1fr 3fr;\n  padding: 1rem;\n`\nconst Price = styled.div`\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n`\nconst Amount = styled(Price)``\nconst ProductName = styled(Price)``\nconst StyledButton = styled(Button)`\n  background-color: #ff8e0a;\n  font-size: 1rem;\n  padding: 0rem 2rem;\n`\nconst DeleteIcon = styled(Icon)`\n  cursor: pointer;\n  & svg {\n    fill: red;\n  }\n  margin-left: 1rem;\n  font-size: 1.25rem;\n`\n\nexport const ShoppingCart = () => {\n  const { data, loading, error } = useQuery(GET_ME)\n  const router = useRouter()\n  const [deleteProductItem] = useMutation(DELETE_ITEM, {\n    update(cache, mutationResult) {\n      const { me } = cache.readQuery({ query: GET_ME })\n      const user = me as User\n      const oldShoppingItems = [...user.shoppingCart.productItems]\n      const newShoppingItems = oldShoppingItems.filter(\n        i => i.id !== mutationResult.data.deleteShoppingCartItem.id,\n      )\n      const newUser = { ...user }\n      newUser.shoppingCart.productItems = [...newShoppingItems]\n      // cache.writeData(newUser)\n    },\n  })\n  if (loading) return <div>Lodaing...</div>\n  if (!data) {\n    router.push('/signin')\n    return null\n  }\n  const me = data.me as User\n  const shoppingCart = me.shoppingCart as ShoppingCart\n  const shoppingCartItems = shoppingCart.productItems\n\n  const showDeleteConfirm = async (key: string, name: string) => {\n    confirm({\n      title: `คุณต้องการนำสินค้า ${name} ออกใช่หรือไม่?`,\n      content: '',\n      okText: 'ลบ',\n      okType: 'danger',\n      cancelText: 'ยกเลิก',\n      async onOk() {\n        await deleteItem(key)\n      },\n      onCancel() {\n        console.log('Cancel')\n      },\n    })\n  }\n\n  const deleteItem = async (key: string) => {\n    try {\n      await deleteProductItem({ variables: { key } })\n      message.success('รบรายการ สำเร็จ')\n    } catch (error) {\n      message.error('error has occur')\n    }\n  }\n\n  return (\n    <Container>\n      <h2>รถเข็นสินค้า ({shoppingCartItems.length})</h2>\n      <CartTable>\n        <CartRow>\n          <h4>สินค้า</h4>\n          <h4>ราคา</h4>\n          <h4>ปริมาณ</h4>\n          <h4>ราคารวม</h4>\n        </CartRow>\n        {shoppingCartItems.map(item => {\n          const { product, amount } = item\n          return (\n            <CartRow>\n              <Product>\n                <ProductCardTall buyable={false} onlyImage />\n                <ProductName>\n                  {product.name}\n                  <DeleteIcon\n                    onClick={() =>\n                      showDeleteConfirm(\n                        `${product.id}${shoppingCart.id}`,\n                        product.name,\n                      )\n                    }\n                    type=\"delete\"\n                  />\n                </ProductName>\n              </Product>\n              <Price>\n                {product.salePrice} บาท / {product.unitType}\n              </Price>\n              <Amount>\n                <AmountInput onChange={e => null} amount={amount} />\n              </Amount>\n              <Price>\n                {(+product.salePrice * amount).toLocaleString()} บาท\n              </Price>\n            </CartRow>\n          )\n        })}\n        <div>\n          <CartSumRow>\n            <h2>ราคารวม ({shoppingCartItems.length} รายการ)</h2>\n            <h2>\n              {shoppingCartItems\n                .reduce(\n                  (prv, cur) => prv + cur.amount * +cur.product.salePrice,\n                  0,\n                )\n                .toLocaleString()}{' '}\n              บาท\n            </h2>\n          </CartSumRow>\n          <CartSumRow>\n            <StyledButton>พิมพ์ใบเสนอราคา</StyledButton>\n            <StyledButton>ถัดไป</StyledButton>\n          </CartSumRow>\n        </div>\n      </CartTable>\n    </Container>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}